<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Financeiro Invoices</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <%- include('partials/styles') %>
</head>
<body>
  <div class="row g-0" style="min-height: 100vh;">
    <%- include('partials/sidebar', { activeMenu: 'dashboard' }) %>
    <div class="col-md-9 col-lg-10 col-12 main-content">
      <%- include('partials/header', { user: user }) %>

      <div class="row mt-3 mb-3">
        <div class="col-md-4">
          <form method="GET" action="/" class="d-flex gap-2">
            <input type="date" class="form-control" name="filterDate" id="filterDate">
            <button type="submit" class="btn btn-outline-primary">
              <i class="fas fa-filter"></i> Filtrar
            </button>
            <a href="/" class="btn btn-outline-secondary">
              <i class="fas fa-times"></i> Limpar
            </a>
          </form>
        </div>
      </div>

      <%- include('partials/alerts', { messages: typeof messages !== 'undefined' ? messages : null }) %>

      <h2 class="page-title">Últimas Recargas</h2>
      <div class="invoice-table table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>Gateway</th>
              <th>Valor</th>
              <th>Status</th>
              <th>Data</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody>
            <% if (invoices && invoices.data && invoices.data.length > 0) { %>
              <% invoices.data.forEach(invoice => { %>
                <tr>
                  <td><strong>#<%= invoice.id %></strong></td>
                  <td><%= invoice.email %></td>
                  <td><%= invoice.gateway %></td>
                  <td>R$ <%= parseFloat(invoice.valor || 0).toFixed(2) %></td>
                  <td>
                    <span class="badge-status <%= invoice.status %>">
                      <%= invoice.status %>
                    </span>
                  </td>
                  <td><%= new Date(invoice.createdAt).toLocaleDateString('pt-BR') %></td>
                  <td>
                    <a href="/invoice/<%= invoice.id %>" class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-eye"></i> Ver
                    </a>
                  </td>
                </tr>
              <% }); %>
            <% } else { %>
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  Nenhum invoice encontrado
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>

      <%- include('partials/pagination', { data: invoices, baseUrl: '/', filterDate: typeof filterDate !== 'undefined' ? filterDate : null }) %>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

